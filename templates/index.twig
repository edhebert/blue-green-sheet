{% extends "_layout.twig" %}

{# Get some stats for display #}
{% set jobCount = craft.entries.section('jobs').count() %}
{% set orgCount = craft.entries.section('organizations').count() %}

{% block title %}{{ siteName }} - Private School Leadership Opportunities{% endblock %}

{% block styles %}
<style>
.dark .slider-caption, .dark .slider-caption h2, .dark .slider-caption p {
    text-shadow: 2px 2px 2px rgba(0,0,0,0.5);
}
.dark .slider-caption a, .dark .slider-caption a:hover {
    text-shadow: none;
}

</style>
{% endblock %}


{% block slider %}
    <section id="slider" class="slider-element slider-parallax swiper_wrapper min-vh-60 min-vh-md-100 include-header" style="background-color: #000;">
        <div class="slider-inner">
            <div class="swiper swiper-parent">
                <div class="swiper-wrapper">
                    <div class="swiper-slide dark">
                        <div class="container">
                            <div class="slider-caption slider-caption-center mt-lg-6">
                                <h2 data-animate="fadeInUp">{{ entry.title }}</h2>
                                <p class="d-none d-sm-block" data-animate="fadeInUp" data-delay="200">{{entry.subheading}}</p>
                                <p data-animate="fadeInUp" data-delay="300">
                                    <a href="{{ siteUrl }}jobs" class="button button-large rounded-pill px-5 px-lg-6 py-lg-4 py-3 mt-6"><span>Find Your Next Job<i class="bi-arrow-right ms-2 me-0"></i></span></a>
                                </p>
                                
                            </div>
                        </div>
                        <div class="swiper-slide-bg" style="background-image: url('{{ siteUrl }}images/sanborn-desat.jpg'); opacity:0.4"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

{% endblock %}

{% block content %}

<div class="container">

  {# Recent Jobs Section #}
  {% set recentJobs = craft.entries.section('jobs').limit(3).all() %}
  {% if recentJobs|length %}
    <div class="mb-5">
      <div class="d-flex justify-content-between align-items-center mb-5">
        <h2 class="mb-0">{{ jobCount }} Current Job Opportunities</h2>
        <a href="/jobs" class="button button-outline button-large rounded-pill">View All</a>
      </div>

      <div class="row g-4">
        {% for job in recentJobs %}
          {% set school = job.school.one() %}
          {% set listingOrg = job.listingOrganization.one() %}
          {% set isRecruiterPosted = listingOrg and listingOrg.organizationType == 'recruiter' %}

          <div class="col-md-4">
            <div class="card h-100 border-0 shadow-sm">
              <div class="card-body">
                {# School Logo or Initials #}
                {% if school %}
                  {% if school.logo|length %}
                    <div class="img-container mb-3">
                      <img src="{{ school.logo.one().url('height100') }}" alt="{{ school.title }}" style="max-height: 80px; max-width: 100%; display:block; margin:0 auto;">
                    </div>
                  {% else %}
                    {# Show initials if no logo #}
                    {% set words = school.title|split(' ') %}
                    {% set initials = '' %}
                    {% for word in words %}
                      {% if word|length > 0 and loop.index <= 3 %}
                        {% set initials = initials ~ word|slice(0, 1)|upper %}
                      {% endif %}
                    {% endfor %}
                    <div class="school-initials mb-3" style="width: 80px; height: 80px; background-color: #e3f2fd; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin: 0 auto;">
                      <span style="font-size: 1.5rem; font-weight: 600; color: #1976d2;">{{ initials }}</span>
                    </div>
                  {% endif %}
                {% endif %}

                {# School Name (first line, prominent) #}
                {% if school %}
                  <h3 class="h6 fw-bold mb-1 text-center">{{ school.title }}</h3>
                {% endif %}

                {# Job Title (second line) #}
                <h2 class="h6 mb-2 text-center">
                  <a href="{{ job.url }}" class="text-decoration-none stretched-link">{{ job.title }}</a>
                </h2>

                {# Location - based on country #}
                {% if job.country == 'international' and job.jobLocation|length %}
                  <p class="text-muted small mb-2 text-center">
                    <i class="bi bi-geo-alt me-1"></i>
                    {{ job.jobLocation }}
                  </p>
                {% elseif job.country == 'unitedStates' and (job.jobCity|length or job.jobState|length) %}
                  <p class="text-muted small mb-2 text-center">
                    <i class="bi bi-geo-alt me-1"></i>
                    {{ job.jobCity }}{% if job.jobCity|length and job.jobState|length %}, {% endif %}{{ job.jobState }}
                  </p>
                {% endif %}

                {# Category badge only #}
                <div class="d-flex flex-wrap gap-1 mb-3" style="justify-content: center;">
                  {% if job.jobCategory|length %}
                    <span class="badge bg-primary bg-opacity-10 text-primary" style="white-space: normal; text-align: left; line-height: 1.4;">{{ job.jobCategory.one().title }}</span>
                  {% endif %}
                </div>

                {# Recruiter Attribution (if posted by recruiter) #}
                {% if isRecruiterPosted %}
                  <p class="text-muted small fst-italic mb-3 text-center" style="position: relative; z-index: 2;">
                    <a href="{{ listingOrg.url }}" style="display:block; margin: 0 auto;" class="mt-5 mb-3"><img src="{{ listingOrg.logo.one().url('height50') }}" alt="{{ listingOrg.title }}"></a>
                    Search being conducted by<br> <a href="{{ listingOrg.url }}" class="text-decoration-none" style="position: relative;">{{ listingOrg.title }}</a>
                  </p>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  {% endif %}

  {# User-specific content #}
  {% if currentUser %}
    <div class="card border-0 bg-primary bg-opacity-10 mb-4">
      <div class="card-body text-center p-4">
        <h2 class="h5 mb-3">Welcome back, {{ currentUser.firstName }}!</h2>
        <p class="text-muted mb-3">Ready to explore new opportunities in private education?</p>
        <div class="d-flex flex-wrap justify-content-center gap-3">
          <a href="{{siteUrl}}jobs" class="button rounded-pill">Browse Latest Positions</a>
          <a href="{{siteUrl}}profile" class="button button-border border-width-2 rounded-pill">Manage Profile</a>
        </div>
      </div>
    </div>
  {% else %}
    <div class="card border-0 bg-primary bg-opacity-10 mb-4">
      <div class="card-body text-center p-4">
        <h2 class="h5 mb-3">Find Qualified Professionals for Educational Leadership</h2>
        <p class="text-muted mb-3">Register or sign in to post your job openings!</p>
        <div class="d-flex flex-wrap justify-content-center gap-3">
          <a href="{{ siteUrl }}/register" class="button rounded-pill">Create Free Account</a>
          <a href="{{ siteUrl }}/login" class="button button-border border-width-2 rounded-pill">Sign In</a>
        </div>
      </div>
    </div>
  {% endif %}
</div>
{% endblock %}