{% extends "_layout.twig" %}

{# Get some stats for display #}
{% set jobCount = craft.entries.section('jobs').count() %}
{% set orgCount = craft.entries.section('organizations').count() %}

{% block title %}{{ siteName }} - Private School Leadership Opportunities{% endblock %}

{% block styles %}
<style>
.dark .slider-caption, .dark .slider-caption h2, .dark .slider-caption p {
    text-shadow: 2px 2px 2px rgba(0,0,0,0.5);
}
.dark .slider-caption a, .dark .slider-caption a:hover {
    text-shadow: none;
}

</style>
{% endblock %}


{% block slider %}
    <section id="slider" class="slider-element slider-parallax swiper_wrapper min-vh-60 min-vh-md-75 include-header" style="background-color: #000;">
        <div class="slider-inner">
            <div class="swiper swiper-parent">
                <div class="swiper-wrapper">
                    <div class="swiper-slide dark">
                        <div class="container">
                            <div class="slider-caption slider-caption-center mt-lg-6">
                                <h2 data-animate="fadeInUp">School Leadership Starts Here.</h2>
                                <p class="d-none d-sm-block" data-animate="fadeInUp" data-delay="200">Connecting exceptional leaders with outstanding private schools. Find your next career opportunity in independent education.</p>
                                <p data-animate="fadeInUp" data-delay="300">
                                    <a href="{{ siteUrl }}jobs" class="button button-large rounded-pill px-5 px-lg-6 py-lg-4 py-3 mt-6"><span>Find Your Next Job<i class="bi-arrow-right ms-2 me-0"></i></span></a>
                                </p>
                                
                            </div>
                        </div>
                        <div class="swiper-slide-bg" style="background-image: url('{{ siteUrl }}images/sanborn-desat.jpg'); opacity:0.4"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

{% endblock %}

{% block content %}

<div class="container">

  {# Recent Jobs Section #}
  {% set recentJobs = craft.entries.section('jobs').limit(3).all() %}
  {% if recentJobs|length %}
    <div class="mb-5">
      <div class="d-flex justify-content-between align-items-center mb-5">
        <h2 class="mb-0">{{ jobCount }} Current Opportunities</h2>
        <a href="/jobs" class="button button-outline button-large rounded-pill">View All</a>
      </div>

      <div class="row g-4">
        {% for job in recentJobs %}
          <div class="col-md-4">
            <div class="card h-100 border-0 shadow-sm">
              <div class="card-body">
                

                {% if job.author.organization.one().logo[0]|length %}
                    <div class="img-container mb-4" style="min-height: 100px">
                        <img src="{{ job.author.organization.one().logo[0].url('height100') }}" alt="{{ job.author.organization.title }}" style="display:block; margin:0 auto;">
                    </div>                   
                {% endif %}


                <h3 class="h6 mb-2">
                  <a href="{{ job.url }}" class="text-decoration-none">{{ job.title }}</a>
                </h3>

                <div class="d-flex flex-wrap gap-1 mb-3">
                  {% if job.jobCategory|length %}
                    <span class="badge bg-primary bg-opacity-10 text-primary">{{ job.jobCategory.one().title }}</span>
                  {% endif %}
                  {% if job.jobRegion|length %}
                    <span class="badge bg-secondary bg-opacity-10 text-secondary">{{ job.jobRegion.one().title }}</span>
                  {% endif %}
                </div>

                {% if job.jobOpportunityStatement %}
                  <p class="text-muted small mb-3">{{ job.jobOpportunityStatement|length > 100 ? job.jobOpportunityStatement|slice(0, 100) ~ '...' : job.jobOpportunityStatement }}</p>
                {% endif %}

                <div class="d-flex justify-content-between align-items-center">
                  <small class="text-muted">Posted {{ job.postDate|date('M j') }}</small>
                  <a href="{{ job.url }}" class="button button-outline button-mini rounded-pill">View Details</a>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  {% endif %}

  {# User-specific content #}
  {% if currentUser %}
    <div class="card border-0 bg-primary bg-opacity-10 mb-4">
      <div class="card-body text-center p-4">
        <h2 class="h5 mb-3">Welcome back, {{ currentUser.firstName }}!</h2>
        <p class="text-muted mb-3">Ready to explore new opportunities in private education?</p>
        <div class="d-flex flex-wrap justify-content-center gap-3">
          <a href="{{siteUrl}}jobs" class="button rounded-pill">Browse Latest Positions</a>
          <a href="{{siteUrl}}profile" class="button button-border border-width-2 rounded-pill">Manage Profile</a>
        </div>
      </div>
    </div>
  {% else %}
    <div class="card border-0 bg-primary bg-opacity-10 mb-4">
      <div class="card-body text-center p-4">
        <h2 class="h5 mb-3">Find Qualified Professionals for Educational Leadership</h2>
        <p class="text-muted mb-3">Register or sign in to post your job openings!</p>
        <div class="d-flex flex-wrap justify-content-center gap-3">
          <a href="{{ siteUrl }}/register" class="button rounded-pill">Create Free Account</a>
          <a href="{{ siteUrl }}/login" class="button button-border border-width-2 rounded-pill">Sign In</a>
        </div>
      </div>
    </div>
  {% endif %}
</div>
{% endblock %}