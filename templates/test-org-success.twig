{% requireLogin %}
{% extends "_layout.twig" %}

{% block title %}Organization Created · {{ siteName }}{% endblock %}

{% block content %}
  {# Check if we have a new org ID to assign #}
  {% set newOrgId = craft.app.request.getParam('newOrgId') %}

  {# Auto-assign the organization to the current user #}
  {% if newOrgId %}
    <form id="autoAssignOrg" method="post" class="d-none">
      {{ csrfInput() }}
      {{ actionInput('users/save-user') }}
      {{ hiddenInput('userId', currentUser.id) }}
      {{ redirectInput('/test-org-complete') }}
      {{ hiddenInput('fields[organization][]', newOrgId) }}
    </form>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('autoAssignOrg')?.submit();
      });
    </script>
    <noscript>
      <div class="container" style="max-width: 600px;">
        <div class="alert alert-info">Organization created! Click below to assign it to your profile.</div>
        <form method="post">
          {{ csrfInput() }} {{ actionInput('users/save-user') }}
          {{ hiddenInput('userId', currentUser.id) }} {{ redirectInput('/test-org-complete') }}
          {{ hiddenInput('fields[organization][]', newOrgId) }}
          <button class="btn btn-primary">Assign Organization and Continue</button>
        </form>
      </div>
    </noscript>
  {% endif %}

  <div class="container" style="max-width: 600px;">
    <div class="card shadow-sm">
      <div class="card-body text-center">
        <h1 class="h4 text-success mb-3">✓ Organization Created Successfully!</h1>
        <p class="text-muted mb-4">Your organization has been created and is now being assigned to your profile...</p>

        {% if newOrgId %}
          <p class="small text-muted">Organization ID: {{ newOrgId }}</p>
        {% endif %}

        <div class="d-grid gap-2 d-sm-flex justify-content-sm-center">
          <a href="/profile" class="btn btn-primary">Return to Profile</a>
          <a href="/test-org-form" class="btn btn-outline-secondary">Create Another</a>
        </div>
      </div>
    </div>
  </div>
{% endblock %}